<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Data Table</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        #table-container {
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        #data-table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }

        th {
            background-color: #f0f0f0;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
    </style>
</head>
<body>
    <h1>API Data Table</h1>
    <div id="table-container">
        <table id="data-table">
            <thead>
                <tr>
                    <!-- Table headers will be generated dynamically -->
                </tr>
            </thead>
            <tbody>
                <!-- Table data will be generated dynamically -->
            </tbody>
        </table>
    </div>

    <script>
        const apiUrl = 'https://reports-api.momence.com/host/13752/reports/new-visitors?timeZone=Asia%2FKolkata&day=2023-09-24&startDate=2023-07-01T18:30:00.000Z&endDate=2025-12-31T18:29:00.000Z';
        const excludedMemberIds = [
            15338497, 16288193, 15119005, 1558934, 15337432, 15343252, 15975745, 15343999, 1342000,
            15300776, 15341847, 15339393, 15119002, 15341359, 15338258, 15337832, 15338313, 15337323,
            16098069, 15343486, 15336512, 15343712, 16288189, 15338496, 15337329, 15340788, 15975071,
            15931331, 15913204, 15913221, 16256662, 15341284, 15339006, 1342000, 1342012, 17611091, 18002802, 17962795, 17441424, 17435973, 17128715, 17662843, 17715555, 17611091, 17080950
        ];
        const excludedMembershipTypes = [
            'Studio Private Class',
            'Studio 3 Month Unlimited Membership',
            'Studio 12 Class Package',
            'Studio 8 Class Package',
            'Studio 1 Month Unlimited Membership',
            'Studio 2 Week Unlimited Membership',
            'Studio Single class',
            'Studio Annual Unlimited Membership',
            'Studio 2 Week Unlimited',
            'Studio 4 Class Package',
            'Virtual Private Class',
            'Studio 6 Month Unlimited Membership',
            'Studio 20 Single Class Pack',
            'Studio 10 Single Class Pack',
            'Studio Happy Hour Private',
            'Studio FLEX 4 Class',
            'pay-later',
            'Studio Staff/Family Class',
            'Studio 8 Class Package',
            'Studio 12 Class Package',
            'Studio 2 Week Unlimited',
            'Studio 20 Single Class Pack',
            'Studio 3 Month Unlimited Membership',
            'Studio 1 Month Unlimited Membership',
            'Studio Single Class',
            'Studio Annual Unlimited Membership',
            'Studio Newcomers 2 Week Unlimited Membership',
            'Studio 4 Class Package',
            'V\'Day Special: Shared Studio 8 Class Package '
        ];

        async function fetchData() {
            try {
                const response = await fetch(apiUrl, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Cookie': await authenticateAndGetCookie()
                    }
                });

                if (!response.ok) {
                    throw new Error('Error fetching data');
                }

                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }

        function authenticateAndGetCookie() {
            return new Promise((resolve, reject) => {
                const loginPayload = {
                    email: 'jimmeey@physique57india.com',
                    password: 'Jimmeey@123'
                };

                fetch('https://api.momence.com/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(loginPayload)
                })
               .then(response => response.headers.get('Set-Cookie'))
               .then(cookie => resolve(cookie))
               .catch(error => reject(error));
            });
        }

        async function generateTable() {
            const data = await fetchData();
            const tableContainer = document.getElementById('table-container');
            const table = document.getElementById('data-table');
            const headers = Object.keys(data.items[0]);
            const tableHeaders = headers.map(header => `<th>${header}</th>`).join('');
            table.querySelector('thead tr').innerHTML = tableHeaders;

            const filteredData = data.items.filter(item => {
                return!(excludedMemberIds.includes(item.memberId) ||
                    excludedMembershipTypes.includes(item.membershipUsed) ||
                    item.paymentMethod === "pay-later");
            });

            const tableRows = filteredData.map(item => {
                const row = headers.map(header => `<td>${item[header]}</td>`).join('');
                return `<tr>${row}</tr>`;
            }).join('');

            table.querySelector('tbody').innerHTML = tableRows;
        }

        generateTable();
    </script>
</body>
</html>
